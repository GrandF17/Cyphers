#include <cstdint>
#include <iomanip>
#include <iostream>

#include "./classes/integrity.cpp"
#include "./libs/streebog.h"
#include "./utils/mac.cpp"
#include "./utils/vLog.cpp"

using namespace std;

int main(int argc, char** argv) {
    Logger logger = Logger("./logs.txt", false);
    IntegrityControl watcher;
    watcher.createReferenceFile(argv, &logger);
    watcher.startChecksumwatcher(argv, &logger);
    // by default streebog returns 32 bit hash
    cout << "Streebog hash: " << streebog("The quick brown fox jumps over the lazy dog") << endl;
    vector<uint8_t> key256 = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
                              0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
                              0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
                              0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f};
    vector<uint8_t> key512 = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
                              0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
                              0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
                              0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f,
                              0xb1, 0x08, 0x5b, 0xda, 0x1e, 0xca, 0xda, 0xe9,
                              0xeb, 0xcb, 0x2f, 0x81, 0xc0, 0x65, 0x7c, 0x1f,
                              0x2f, 0x6a, 0x76, 0x43, 0x2e, 0x45, 0xd0, 0x16,
                              0x71, 0x4e, 0xb8, 0x8d, 0x75, 0x85, 0xc4, 0xfc};
    vector<uint8_t> text = {0x01, 0x26, 0xbd, 0xb8, 0x78, 0x00, 0xaf, 0x21, 0x43, 0x41, 0x45, 0x65, 0x63, 0x78, 0x01, 0x00};

    cout << "HMAC result (key256): " << endl;
    printVector(HMAC(key256, text));

    cout << "NMAC result (key256): " << endl;
    printVector(NMAC(key256, text));

    cout << "HMAC result (key512): " << endl;
    printVector(HMAC(key512, text));

    cout << "NMAC result (key512): " << endl;
    printVector(NMAC(key512, text));
    watcher.~IntegrityControl();
    return 0;
}
